
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ADMIN Workstation Queue Dashboard </title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { font-size: 24px; margin-bottom: 10px; }
        h2, h3 { font-size: 14px; margin-top: 20px; color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
        .form-section { margin-top: 30px; }
        .form-section input, .form-section select { margin-right: 10px; padding: 5px; }
        .submit-btn { padding: 6px 12px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        .submit-btn:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <h1>ADMIN Workstation Queue Dashboard</h1>

    <h2>üìä Workstation Usage Over Time</h2>
    <div id="usageChart" style="width:100%;height:400px;"></div>

    <script>
        var chartData = {{ chart_data | tojson }};
        var data = chartData.map(item => ({
            x: [item.start, item.end],
            y: [item.workstation, item.workstation],
            mode: 'lines',
            name: item.name,
            line: { color: item.color, width: 10 }
        }));

        var layout = {
            title: 'Workstation Usage Timeline (Running Only)',
            xaxis: { title: 'Time' },
            yaxis: { title: 'Workstations' },
            showlegend: true
        };

        Plotly.newPlot('usageChart', data, layout);
    </script>

<h3>üñ•Ô∏è Running Workstations</h3>
    <table>
        <tr><th>Timestamp</th><th>Name</th><th>Role</th><th>Workstation</th><th>Start Time</th><th>End Time</th><th>Status</th><th>Renewals</th></tr>
        {% for req in running_requests %}
        <tr>
            <td>{{ req.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ req.name }}</td>
            <td>{{ req.role }}</td>
            <td>{{ req.workstation }}</td>
            <td>{{ req.start_time }}</td>
            <td>{{ req.end_time }}</td>
            <td>{{ req.status }}</td>
            <td>{{ req.renewals }}</td>
            <td>
               <form method="POST" action="/update_status/{{ req.id }}">
                                <select name="status">
                                    <option value="Pending" {% if req.status == 'Pending' %}selected{% endif %}>Pending</option>
                                    <option value="Running" {% if req.status == 'Running' %}selected{% endif %}>Running</option>
                                    <option value="Completed" {% if req.status == 'Completed' %}selected{% endif %}>Completed</option>
                                </select>
                                <input type="text" name="renewals" placeholder="Renewals" value="{{ req.renewals }}">
                                <input type="text" name="workstation" placeholder="Workstation" value="{{ req.workstation or '' }}">
                                <input type="date" name="start_time" placeholder="StartTime" value="{{ req.start_time }}">
                                <input type="date" name="end_time" placeholder="EndTime" value="{{ req.end_time }}">
                                <button type="submit">Update</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>


<h3>üìã Live Queue of Requests</h3>
<table>
<tr>
<th>Timestamp</th>
<th>Name</th>
<th>Role</th>
<th>Workstation</th>
<th>Start Time</th>
<th>End Time</th>
<th>Status</th>
</tr>
        {% for req in requests %}
        <tr>
            <td>{{ req.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ req.name }}</td>
            <td>{{ req.role }}</td>
            <td>{{ req.workstation or '' }}</td>
            <td>{{ req.start_time }}</td>
            <td>{{ req.end_time }}</td>
            <td>{{ req.status }}</td>
            <td>
                <form method="POST" action="/update_status/{{ req.id }}">
                    <select name="status">
                        <option value="Pending" {% if req.status == 'Pending' %}selected{% endif %}>Pending</option>
                        <option value="Running" {% if req.status == 'Running' %}selected{% endif %}>Running</option>
                        <option value="Completed" {% if req.status == 'Completed' %}selected{% endif %}>Completed</option>
                    </select>
                    <input type="text" name="workstation" placeholder="Workstation" value="{{ req.workstation or '' }}">
                    <input type="date" name="start_time" placeholder="StartTime" value="{{ req.start_time }}">
                    <input type="date" name="end_time" placeholder="EndTime" value="{{ req.end_time }}">
                    <button type="submit">Update</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
    
<div class="form-section">
<h3>üìù Submit a New Workstation Request</h3>
<form id="requestForm">
<input name="name" placeholder="Name" required="" type="text"/>
<select name="role">
<option value="Researcher">Researcher</option>
<option value="PhD">PhD</option>
<option value="Master">Master</option>
<option value="Short term">Short term</option>
</select>
<input name="startTime" required="" type="date"/>
<input name="endTime" required="" type="date"/>
<button class="submit-btn" type="submit">Submit Request</button>
</form>
</div>
<script>
        document.getElementById('requestForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const data = {
                name: this.name.value,
                role: this.role.value,
                startTime: this.startTime.value,
                endTime: this.endTime.value
            };

            fetch('/submit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                alert('Request submitted successfully!');
                location.reload();
            })
            .catch(error => console.error('Error:', error));
        });
    </script>
<div style="background-color:#f9f9f9; padding:15px; border:1px solid #ccc; margin-bottom:20px;">
<h3>‚ÑπÔ∏è Usage Guidelines
<table border="1" style="width:100%; margin-top:10px; border-collapse:collapse;">
<thead>
<tr style="background-color:#f2f2f2;">
<th>Role</th>
<th>Max Usage</th>
<th>Workstations</th>
<th>Renewals Allowed</th>
</tr>
</thead>
<tbody>
<tr>
<td>Researchers (Post-docs, Assistant/Associate Professors)</td>
<td>4 months</td>
<td>WS-1 to WS-6</td>
<td>Up to 2 renewals</td>
</tr>
<tr>
<td>PhD Students</td>
<td>3 months</td>
<td>WS-7 to WS-9</td>
<td>Up to 1 renewals</td>
</tr>
<tr>
<td>Master Students</td>
<td>5 months</td>
<td>WS-10 to WS-11</td>
<td>No renewals</td>
</tr>
<tr>
<td>Short Term users (Researchers, PhD or Master)</td>
<td>2 weeks</td>
<td>WS-12</td>
<td>No renewals</td>
</tr>
</tbody>
</table>
</h3>
</body>
</html>

